<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Promptly API</title>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
</head>
<body>
  <script>
    let fuse, data = [];
    
    // Parse query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const action = urlParams.get('action') || 'list';
    const query = urlParams.get('q');
    const id = urlParams.get('id');
    
    async function init() {
      try {
        const res = await fetch('data.json');
        data = await res.json();
        
        // Initialize Fuse.js for search
        fuse = new Fuse(data, {
          keys: ['name', 'description', 'tags'],
          threshold: 0.3
        });
        
        // Handle different actions
        switch(action) {
          case 'get':
            if (id) {
              getDataById(id);
            } else {
              sendResponse({error: 'Missing ID parameter'});
            }
            break;
          case 'search':
            if (query) {
              searchData(query);
            } else {
              sendResponse({error: 'Missing search query'});
            }
            break;
          case 'list':
          default:
            listData();
            break;
        }
      } catch (error) {
        sendResponse({error: 'Failed to load data'});
      }
    }
    
    function listData() {
      sendResponse(data);
    }
    
    function getDataById(id) {
      // First try to find by exact ID match (for our new 4-digit IDs)
      let item = data.find(d => d.id === id);
      
      // If not found, try to search by ID in the query (for backward compatibility)
      if (!item && id) {
        const results = fuse.search(id);
        if (results.length > 0) {
          item = results[0].item;
        }
      }
      
      if (item) {
        sendResponse(item);
      } else {
        sendResponse({error: 'Template not found'});
      }
    }
    
    function searchData(query) {
      const results = fuse.search(query);
      sendResponse(results.map(r => r.item));
    }
    
    function sendResponse(response) {
      // Clear the body and display JSON response
      document.body.innerHTML = '';
      const pre = document.createElement('pre');
      pre.textContent = JSON.stringify(response, null, 2);
      document.body.appendChild(pre);
    }
    
    // Initialize the API
    init();
  </script>
</body>
</html>